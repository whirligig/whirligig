/**
* Name: PiroBox Extended v.1.1 Beta
* Date: Feb 2011
* Autor: Diego Valobra (http://www.pirolab.it),(http://www.diegovalobra.com)
* Version: 1.1
* Licence: CC-BY-SA http://creativecommons.org/licenses/by-sa/3/it/
**/
(function(e){e.piroBox_ext=function(t){function d(){e(window).scroll(function(){var t=e(window).height(),n=e(window).width(),r=h.height()-20,i=h.width();h.css({left:n/2-i/2+"px",top:parseInt(e(document).scrollTop())+(t-r)/2+p})})}function v(){if(e(".piro_close").is(":visible")){e(".zoomIn").add(".zoomOut").add(".my_frame").add(".caption").remove();h.add(div_reg).add(resize).stop();if(t.piro_drag==true){h.draggable({disabled:false})}var n=h;if(e.browser.msie){n=div_reg.add(piro_bg);e(".div_reg img").remove()}else{n=h.add(piro_bg)}n.piroFadeOut(200,function(){div_reg.html("");piro_loader.hide();piro_nav.hide();piro_bg.add(h).hide().css("visibility","visible")})}}t=jQuery.extend({piro_speed:700,bg_alpha:.9,piro_scroll:true,piro_drag:null,piro_nav_pos:"top"},t);e.fn.piroFadeIn=function(t,n){e(this).fadeIn(t,function(){if(jQuery.browser.msie)e(this).get(0).style.removeAttribute("filter");if(n!=undefined)n()})};e.fn.piroFadeOut=function(t,n){e(this).fadeOut(t,function(){if(jQuery.browser.msie)e(this).get(0).style.removeAttribute("filter");if(n!=undefined)n()})};var n=e('a[class*="pirobox"]');var r=new Object;for(var i=0;i<n.length;i++){var s=e(n[i]);r["a."+s.attr("class").match(/^pirobox_gall\w*/)]=0}var o=new Array;for(var u in r){o.push(u)}for(var i=0;i<o.length;i++){e(o[i]+":first").addClass("first");e(o[i]+":last").addClass("last")}var a=e(n);e('a[class*="pirobox_gall"]').each(function(e){this.rev=e+0});if(e('a[class*="pirobox_gall"]').length==1){e('a[class*="pirobox_gall"]').each(function(){e(this).addClass("single_fix")})}else{}var f='<div class="caption"></div>';var l=.9;var c='<div class="piro_overlay"></div>'+'<table class="piro_html"  cellpadding="0" cellspacing="0">'+"<tr>"+'<td class="h_t_l"></td>'+'<td class="h_t_c" title="drag me!!"></td>'+'<td class="h_t_r"></td>'+"</tr>"+"<tr>"+'<td class="h_c_l"></td>'+'<td class="h_c_c">'+'<div class="piro_loader" title="close"><span></span></div>'+'<div class="resize">'+'<div class="nav_container">'+'<a href="#prev" class="piro_prev" title="previous"></a>'+'<a href="#next" class="piro_next" title="next"></a>'+'<div class="piro_prev_fake">prev</div>'+'<div class="piro_next_fake">next</div>'+'<div class="piro_close" title="close"></div>'+"</div>"+'<div class="div_reg"></div>'+"</div>"+"</td>"+'<td class="h_c_r"></td>'+"</tr>"+"<tr>"+'<td class="h_b_l"></td>'+'<td class="h_b_c"></td>'+'<td class="h_b_r"></td>'+"</tr>"+"</table>";e("body").append(c);var h=e(".piro_html");piro_bg=e(".piro_overlay"),piro_nav=e(".nav_container"),piro_next=e(".piro_next"),piro_prev=e(".piro_prev"),piro_next_fake=e(".piro_next_fake"),piro_prev_fake=e(".piro_prev_fake"),piro_close=e(".piro_close"),div_reg=e(".div_reg"),piro_loader=e(".piro_loader"),resize=e(".resize"),y=e(window).height(),x=e(window).width();piro_nav.hide().css(t.piro_nav_pos,"-38px");if(t.piro_nav_pos=="top"){var p=+5}else if(t.piro_nav_pos=="bottom"){var p=-30}h.css({left:x/2-250+"px",top:parseInt(e(document).scrollTop())+100});e(h).add(piro_bg).hide();piro_bg.css({opacity:t.bg_alpha});e(piro_prev).add(piro_next).bind("click",function(t){piro_nav.hide();e(".caption").remove();e(".zoomIn").add(".zoomOut").remove();t.preventDefault();piro_next.add(piro_prev).hide();var n=parseInt(e('a[class*="pirobox_gall"]').filter(".item").attr("rev"));var r=e(this).is(".piro_prev")?e('a[class*="pirobox_gall"]').eq(n-1):e('a[class*="pirobox_gall"]').eq(n+1);r.click()});e("html").bind("keyup",function(t){if(t.keyCode==27){t.preventDefault();if(e(piro_close).is(":visible")){v()}}});e("html").bind("keyup",function(t){if(e(".item").is(".first")){}else if(e(".item").attr("rel")=="single"){piro_nav.show()}else if(t.keyCode==37){t.preventDefault();if(e(piro_close).is(":visible")){piro_prev.click()}}});e("html").bind("keyup",function(t){if(e(".item").is(".last")){}else if(e(".item").attr("rel")=="single"){piro_nav.show()}else if(t.keyCode==39){t.preventDefault();if(e(piro_close).is(":visible")){piro_next.click()}}});e(window).resize(function(){var t=e(window).height(),n=e(window).width(),r=h.height(),i=h.width();h.css({left:n/2-i/2+"px",top:parseInt(e(document).scrollTop())+(t-r)/2+p})});if(t.piro_scroll==true){d()}e(a).each(function(){function s(){function s(){e(".caption").remove();if(r[1]=="full"&&r[2]=="full"){r[2]=e(window).height()-70;r[1]=e(window).width()-55}var n=e(window).height();var i=e(window).width();piro_close.hide();div_reg.add(resize).animate({height:+r[2]+"px",width:+r[1]+"px"},t.piro_speed).css("visibility","visible");h.animate({height:+r[2]+20+"px",width:+r[1]+20+"px",left:i/2-(r[1]/2+10)+"px",top:parseInt(e(document).scrollTop())+(n-r[2])/2+p},t.piro_speed,function(){piro_next.add(piro_prev).add(piro_prev_fake).add(piro_next_fake).css("visibility","visible");piro_nav.show();piro_close.show()})}function o(){piro_nav.add(".caption").hide();if(n==""){e(".caption").remove()}else{e(f).appendTo(resize)}var r=new Image;r.onerror=function(){e(".caption").remove();r.src="http://www.pirolab.it/pirobox/js/error.jpg"};r.onload=function(){var i=r.height;var s=r.width;var o=e(window).height();var u=e(window).width();var a=r.height;var f=r.width;if(a+20>o||f+20>u){var c=(f+20)/u;var d=(a+20)/o;if(d>c){f=Math.round(r.width*(l/d));a=Math.round(r.height*(l/d))}else{f=Math.round(r.width*(l/c));a=Math.round(r.height*(l/c))}e(".zoomIn").add(".zoomOut").remove();e(".h_c_c").append('<a href="#" class="zoomIn" title="">zoomIn</a>');e(".zoomIn,.zoomOut").hide()}else{a=r.height;f=r.width;e(".zoomIn").add(".zoomOut").remove()}var o=e(window).height();var u=e(window).width();e(r).height(a).width(f).hide();e(".div_reg img").remove();e(".div_reg").html("");div_reg.append(r).show();e(r).addClass("immagine");if(t.piro_drag==true){e(".immagine,.h_b_c,.h_t_c").css("cursor","move");if(e.browser.msie){h.draggable({handle:".h_t_c,.h_b_c,.div_reg img"})}else{h.draggable({handle:".h_t_c,.h_b_c,.div_reg img",opacity:.8})}}div_reg.add(resize).animate({height:a+"px",width:f+"px"},t.piro_speed);h.animate({height:a+20+"px",width:f+20+"px",left:u/2-(f+20)/2+"px",top:parseInt(e(document).scrollTop())+(o-a)/2+p},t.piro_speed,function(){piro_loader.hide();var o=resize.width();e(".caption").css({width:o+"px"});e(".caption").html("<p>"+n+"</p>").hide();e(r).fadeIn(300,function(){if(r.src=="http://www.pirolab.it/pirobox/js/error.jpg"){}e(window).scroll(function(){if(e(".zoomOut").is(":visible")){e(r).animate({width:f,height:a,top:0,left:0},600,function(){e(".immagine").css("cursor","auto");e(r).draggable({disabled:true});e(".zoomIn").add(".zoomOut").remove();e(".h_c_c").append('<a href="#" class="zoomIn" title="">zoomIn</a>');e(".zoomIn").show()})}});e(".zoomOut").live("click",function(n){n.preventDefault();e(".immagine").css("cursor","auto");if(t.piro_drag==true){h.draggable({disabled:false})}e(r).draggable({disabled:true});e(".zoomIn").add(".zoomOut").remove();e(".h_c_c").append('<a href="#" class="zoomIn" title="">zoomIn</a>');e(".zoomIn").show();e(r).animate({width:f,height:a,top:0,left:0},600)});e(".zoomIn").live("click",function(n){n.preventDefault();e(".zoomIn").add(".zoomOut").remove();e(".h_c_c").append('<a href="#" class="zoomOut" title="">zoomOut</a>');e(".zoomOut").show();if(t.piro_drag==true){h.draggable({disabled:true})}e(r).draggable({disabled:false});e(r).animate({width:s,height:i,top:-(i-a)/2,left:-(s-f)/2},600,function(){var t=div_reg.offset();var n=t.left+f-s;var o=t.top+a-i;var u=t.left;var l=t.top;e(r).draggable({containment:[n,o,u,l],scrollSpeed:400});e(".immagine").css("cursor","move")})});e(".zoomIn").show();piro_close.show();e(".caption").slideDown(200);piro_next.add(piro_prev).add(piro_prev_fake).add(piro_next_fake).css("visibility","visible");piro_nav.show();resize.resize(function(){NimgW=r.width;NimgH=r.heigh;e(".caption").css({width:NimgW+"px"})})})})};r.src=i;piro_loader.click(function(){r.src="about:blank"})}h.add(piro_bg).add(div_reg).add(piro_loader).show();switch(r[0]){case"iframe":e(".zoomIn").add(".zoomOut").remove();div_reg.html("").css("overflow","hidden");resize.css("overflow","hidden");piro_close.hide();s();div_reg.piroFadeIn(300,function(){div_reg.append('<iframe id="my_frame" class="my_frame" src="'+i+'" frameborder="0" allowtransparency="true" scrolling="auto" align="top"></iframe>');e(".my_frame").css({height:+r[2]+"px",width:+r[1]+"px"});piro_loader.hide()});break;case"content":e(".zoomIn").add(".zoomOut").remove();div_reg.html("").css("overflow","auto");resize.css("overflow","auto");e(".my_frame").remove();piro_close.hide();s();div_reg.piroFadeIn(300,function(){div_reg.load(i);piro_loader.hide()});break;case"inline":e(".zoomIn").add(".zoomOut").remove();div_reg.html("").css("overflow","auto");resize.css("overflow","auto");e(".my_frame").remove();piro_close.hide();s();div_reg.piroFadeIn(300,function(){e(i).clone(true).appendTo(div_reg).piroFadeIn(300);piro_loader.hide()});break;case"flash":e(".zoomIn").add(".zoomOut").remove();e(".my_frame").remove();div_reg.html("").css("overflow","hidden");s();var u='<object  width="'+r[1]+'" height="'+r[2]+'">'+'<param name="movie" value="'+i+'" />'+'<param name="wmode" value="transparent" />'+'<param name="allowFullScreen" value="true" />'+'<param name="allowscriptaccess" value="always" />'+'<param name="menu" value="false" />'+'<embed src="'+i+'" type="application/x-shockwave-flash" allowscriptaccess="always" menu="false" wmode="transparent" allowfullscreen="true" width="'+r[1]+'" height="'+r[2]+'">'+"</embed>"+"</object>";div_reg.piroFadeIn(300,function(){e(u).appendTo(div_reg);piro_loader.hide()});break;case"gallery":div_reg.css("overflow","hidden");resize.css("overflow","hidden");e(".my_frame").remove();o();break;case"single":e(".my_frame").remove();div_reg.html("").css("overflow","hidden");resize.css("overflow","hidden");o();break}}var n=e(this).attr("title"),r=e(this).attr("rel").split("-"),i=e(this).attr("href");e(this).unbind();e(this).bind("click",function(n){piro_bg.css({opacity:t.bg_alpha});n.preventDefault();piro_next.add(piro_prev).hide().css("visibility","hidden");e(a).filter(".item").removeClass("item");e(this).addClass("item");s();if(e(this).is(".first")){piro_prev.hide();piro_next.show();piro_prev_fake.show().css({visibility:"hidden"})}else{piro_next.add(piro_prev).show();piro_next_fake.add(piro_prev_fake).hide()}if(e(this).is(".last")){piro_prev.show();piro_next_fake.show().css({visibility:"hidden"});piro_next.hide()}if(e(this).is(".pirobox")||e(this).is(".single_fix")){piro_next.add(piro_prev).hide()}if(e(this).is(".last")&&e(this).is(".first")){piro_next.add(piro_prev).hide()}})});e(".immagine").live("click",function(){e(".caption").slideToggle(200)});piro_close.add(piro_loader).add(piro_bg).bind("click",function(e){e.preventDefault();v()})}})(jQuery)